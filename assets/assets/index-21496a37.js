import{n as i,o as e,T as z,N as v,I as C,ar as E,p as H,B as U,P as V,G as Q,Z as D,x as W,W as ee,aF as te,ah as J}from"./vendor-base-cc18fcff.js";import{r as j}from"./index-6524c7ed.js";import{z as T,A,V as Z,q as M,s as _,p as N,W as $,J as F,i as K,M as X,P as ne,ak as se,al as G}from"./shared-4873712f.js";import"./style-pages-42a62cad.js";import{J as oe}from"./index-cbf4ccd1.js";import{u as ae}from"./useS3Upload-00eba9e8.js";import"./vendor-c76f9059.js";import"./__commonjsHelpers__-23102255.js";import"./i18n-helper-ef5bc359.js";/* empty css                     */import"./style-shared-6740825f.js";const le=({onButtonClick:n})=>{const{getIntlText:t}=T(),{getSysTimeFormat:u}=A();return i.useMemo(()=>[{title:t("common.label.product_model"),dataIndex:"model",key:"model",width:"35%",ellipsis:!0,filterSearchType:"search"},{title:t("common.label.update_time"),dataIndex:"updateTime",key:"updateTime",ellipsis:!0,sorter:!0,width:"35%",render(m){const s=u(m);return e.jsx(z,{type:"ellipsisTooltip",title:s,children:s})}},{title:t("common.label.operation"),key:"$operation",align:"right",render(m,s){return e.jsx(v,{size:"sm",align:"end",children:e.jsx("span",{className:"ms-table-pro-oprt-btn",onClick:()=>n("detail",s),onDoubleClick:d=>d.stopPropagation(),children:e.jsx(z,{title:t("common.label.detail"),mouseEnterDelay:.3,children:e.jsx(C,{type:"icon-view-list",colorType:"action"})})})})}}],[t,u,n])},q="en",re=({data:n,...t})=>{var P;const{langs:u,getIntlText:o}=T(),{getDownloadFilename:m}=Z(),[s,d]=i.useState(q),[h,g]=i.useState(!1),[r,l]=i.useState({total:0,current:1,pageSize:10,showLessItems:!0}),{loading:a,data:p,run:y}=E(async()=>{if(!(n!=null&&n.model)||!s)return;const c=await j.getLangDetail({pageSize:r.pageSize,pageNumber:r.current,model:n.model,locale:s});return M(c)},{refreshDeps:[r.current,r.pageSize,n==null?void 0:n.model,s],onSuccess(c){l({...r,total:(c==null?void 0:c.total)||0})}}),w=i.useMemo(()=>[{title:o("common.label.key"),key:"code",dataIndex:"code",ellipsis:!0,width:"50%"},{title:o("common.label.value"),key:"value",dataIndex:"value",ellipsis:!0,width:"50%"}],[o]),x=i.useMemo(()=>Object.entries(u).map(([c,b])=>({value:b.value,label:o(`common.language.${c.toLocaleLowerCase()}`)})),[u,o]),f=_(async()=>{if(!(n!=null&&n.model)||!s)return;g(!0);const[c,b]=await N(j.exportLang({model:[n.model],locale:s?[s]:[]},{responseType:"blob"}));if(g(!1),c)return;const S=window.URL.createObjectURL(b.data),L=m(`${n.model}-${s.toLocaleLowerCase()}`,"xlsx");$(S,L)}),k=i.useMemo(()=>e.jsxs(e.Fragment,{children:[e.jsx(H,{options:x,value:s,disabled:h,onChange:c=>d(c)}),e.jsxs(U,{type:"ghost",loading:h,disabled:h||!r.total,onClick:f,children:[o("common.label.export"),e.jsx(C,{type:"icon-export"})]})]}),[x,s,h,r.total,o,f]),I=c=>{const{current:b,pageSize:S}=c;l({...r,current:b,pageSize:S})},R=(c,b)=>{if(c===1&&b===10&&c===r.current&&b===r.pageSize){y();return}l({...r,current:1,pageSize:10})};return i.useLayoutEffect(()=>{t.visible||d(q)},[t.visible,(P=u.EN)==null?void 0:P.value]),e.jsx(V,{...t,size:"large",title:"Details",className:"ms-resource-lang-detail-modal",footer:e.jsx(e.Fragment,{}),children:e.jsx(F,{name:"table-resource-lang-detail",rowKey:"code",columnsSetup:!1,columnResizable:!1,loading:a,pagination:r,dataSource:(p==null?void 0:p.content)||[],columns:w,toolbarRender:k,onChange:I,onRefresh:R})})},ce=({models:n,onSuccess:t,...u})=>{const{langs:o,getIntlText:m}=T(),{getDownloadFilename:s}=Z(),[d,h]=i.useState([]),[g,r]=i.useState(!1),l=i.useMemo(()=>Object.entries(o).map(([p,y])=>({value:y.value,label:m(`common.language.${p.toLocaleLowerCase()}`)})),[o,m]),a=async()=>{r(!0);const[p,y]=await N(j.exportLang({model:n||[],locale:d},{responseType:"blob"}));if(r(!1),p)return;const w=window.URL.createObjectURL(y.data),x=s("resource-lang","xlsx");$(w,x),t&&t()};return e.jsx(V,{size:"small",className:"ms-resource-lang-export-modal",closable:!1,title:e.jsxs(e.Fragment,{children:[e.jsx(C,{type:"icon-info-f"}),m("mg.resource.list.modal_title_lang_export")]}),okText:m("common.button.confirm"),okButtonProps:{loading:g,disabled:g||!d.length},cancelButtonProps:{disabled:g},onOk:a,...u,children:e.jsx("div",{className:"ms-resource-lang-list",children:e.jsx(Q.Group,{options:l,disabled:g,onChange:h})})})},ie=10*1024*1024,ue=({onSuccess:n})=>{const{getIntlText:t}=T(),[u,o]=i.useState(!1),m=_(async s=>{const d=new FormData;d.append("importFile",s),o(!0);const[h,g]=await N(j.importLang(d));if(o(!1),!(h||!K(g)))return n&&n(s),!1});return e.jsx(X,{accept:".xlsx",maxSize:ie,beforeUpload:m,children:e.jsx(U,{type:"ghost",loading:u,suffix:e.jsx(C,{type:"icon-upload"}),children:t("common.upload.upload")})})},de={ascend:"asc",descend:"desc"},me=()=>{const{getIntlText:n}=T(),[t,u]=i.useState({total:0,current:1,pageSize:10}),[o,m]=i.useState({}),[s,d]=i.useState({}),[h,g]=i.useState([]),[r,l]=i.useState(!1),[a,p]=i.useState(null),{data:y,loading:w,run:x}=E(async()=>{var L;const c=o.columnKey?[{property:o.columnKey,direction:o.order&&de[o.order]}]:void 0,b=(L=s.model)!=null&&L.length?s.model[0]:void 0,S=await j.getLangs({pageSize:t.pageSize,pageNumber:t.current,model:b,sorts:c});return M(S)},{refreshDeps:[t.current,t.pageSize,o,s],onSuccess(c){if(u({...t,total:(c==null?void 0:c.total)||0}),!h.length)return;const b=(c==null?void 0:c.content)||[],S=h.filter(L=>b.find(B=>B.model===L));g(S)}}),f=_((c,b)=>{switch(c){case"detail":{p(b);break}}}),k=le({onButtonClick:f}),I=(c,b,S)=>{const{current:L,pageSize:B}=c,O=Array.isArray(S)?S[0]:S;m(O.order?O:{}),d(!b||Object.entries(b).every(([,Y])=>!Y)?{}:b),u({...t,current:L,pageSize:B})},R=(c,b)=>{if(c===1&&b===10&&c===t.current&&b===t.pageSize){x();return}u({...t,current:1,pageSize:10})},P=i.useMemo(()=>e.jsxs(v,{size:"sm",children:[e.jsx(ue,{onSuccess:()=>{x(),D.success(n("common.upload.success"))}}),e.jsx(U,{type:"ghost",suffix:e.jsx(C,{type:"icon-export"}),onClick:()=>l(!0),children:n("common.label.export")})]}),[n,x]);return e.jsxs(e.Fragment,{children:[e.jsx(F,{name:"table-resource-lang",rowKey:"model",rowSelection:{selectedRowKeys:h,onChange:c=>g(c)},toolbarRender:P,loading:w,pagination:t,columns:k,dataSource:y==null?void 0:y.content,onChange:I,onRefresh:R,onRow:c=>({onDoubleClick:()=>f("detail",c)})}),e.jsx(ce,{visible:r,models:h,onSuccess:()=>{g([]),l(!1)},onCancel:()=>l(!1)}),e.jsx(re,{visible:!!a,data:a,onCancel:()=>p(null)})]})},pe=({onButtonClick:n})=>{const{getIntlText:t}=T(),{getSysTimeFormat:u}=A(),[o,m]=i.useState(null),[s,d]=i.useState({download:!1,delete:!1}),h=i.useCallback(async(r,l)=>{d({...s,[r]:!0}),m(l.id);try{await n(r,l)}catch{}d({...s,[r]:!1}),m(null)},[s,n]);return i.useMemo(()=>{const r=[{type:"download",label:t("common.button.download"),icon:"icon-download"},{type:"delete",label:t("common.label.delete"),icon:"icon-delete"}];return[{title:t("common.label.file_name"),dataIndex:"fileName",key:"fileName",ellipsis:!0,width:"30%"},{title:t("common.label.create_time"),dataIndex:"createTime",key:"createTime",ellipsis:!0,width:"30%",render(l){const a=u(l);return e.jsx(z,{type:"ellipsisTooltip",title:a,children:a})}},{title:t("common.label.update_time"),dataIndex:"updateTime",key:"updateTime",ellipsis:!0,width:"30%",render(l){const a=l?u(l):"";return e.jsx(z,{type:"ellipsisTooltip",title:a,children:a})}},{title:t("common.label.operation"),key:"$operation",align:"right",render(l,a){return e.jsx(v,{size:"sm",align:"end",children:r.map(p=>e.jsx(W,{size:"small",spinning:s[p.type]&&a.id===o,children:e.jsx("span",{className:"ms-table-pro-oprt-btn",onClick:()=>h(p.type,a),onDoubleClick:y=>y.stopPropagation(),children:e.jsx(z,{title:p.label,mouseEnterDelay:.3,children:e.jsx(C,{type:p.icon,colorType:"action"})})})},p.type))})}}]},[s,o,t,u,h])},ge=()=>{const{getIntlText:n}=T(),[t,u]=i.useState({total:0,current:1,pageSize:10}),o=i.useRef(null),[m,s]=i.useState(!1),{data:d,loading:h,run:g}=E(async()=>{const x=await j.getParsers({pageSize:t.pageSize,pageNumber:t.current});return M(x)},{refreshDeps:[t.current,t.pageSize],onSuccess(x){u({...t,total:(x==null?void 0:x.total)||0})}}),r=_(async(x,f)=>{switch(x){case"download":{const[k,I]=await N(j.getParserDetail({parserId:f.id},{$ignoreError:!0})),R=I==null?void 0:I.data;if(k||!R)return;const P=new Blob([JSON.stringify(R,void 0,4)],{type:"text/json"});$(URL.createObjectURL(P),f.fileName);break}case"delete":{ne.secondaryConfirm({title:`${n("common.label.delete")} ${n("mg.resource.tab_title_parser")}`,content:n("common.label.modal_desc_deletion",{1:f.fileName}),async onOk(){const[k,I]=await N(j.deleteParser({parserId:f==null?void 0:f.id}));k||!K(I)||(g(),D.success(n("common.message.delete_success")))}});break}}}),l=pe({onButtonClick:r}),a=_(async(x,f)=>{if(!f.parser){D.error(n("mg.resource.error_parser_no_empty"));return}s(!0),await N(j.addParser({fileName:x.name,context:JSON.stringify(f.parser)})),g(),s(!1),D.success(n("common.upload.success"))}),p=x=>{const{current:f,pageSize:k}=x;u({...t,current:f,pageSize:k})},y=(x,f)=>{if(x===1&&f===10&&x===t.current&&f===t.pageSize){g();return}u({...t,current:1,pageSize:10})},w=i.useMemo(()=>e.jsx(oe,{maxSize:10*1024*1024,onChange:a,children:e.jsx(U,{type:"ghost",suffix:e.jsx(C,{type:"icon-upload"}),loading:m,ref:o,children:n("common.upload.upload")})}),[m,a,n]);return e.jsx(e.Fragment,{children:e.jsx(F,{name:"table-resource-parser",rowKey:"id",toolbarRender:w,loading:h,pagination:t,columns:l,dataSource:d==null?void 0:d.content,onChange:p,onRefresh:y})})},he=({onButtonClick:n})=>{const{getIntlText:t}=T(),{getSysTimeFormat:u}=A(),[o,m]=i.useState(!1),[s,d]=i.useState(null),h=i.useCallback(async(r,l)=>{m(!0),d(l.id);try{await n(r,l)}catch{}m(!1),d(null)},[n]);return i.useMemo(()=>[{title:t("common.label.file_name"),dataIndex:"fileName",key:"fileName",ellipsis:!0,width:"30%"},{title:t("common.label.create_time"),dataIndex:"createTime",key:"createTime",ellipsis:!0,width:"30%",render(r){const l=u(r);return e.jsx(z,{type:"ellipsisTooltip",title:l,children:l})}},{title:t("common.label.update_time"),dataIndex:"updateTime",key:"updateTime",ellipsis:!0,width:"30%",render(r){const l=u(r);return e.jsx(z,{type:"ellipsisTooltip",title:l,children:l})}},{title:t("common.label.operation"),key:"$operation",align:"right",render(r,l){return e.jsx(v,{size:"sm",align:"end",children:e.jsx(W,{size:"small",spinning:o&&l.id===s,children:e.jsx("span",{className:"ms-table-pro-oprt-btn",onClick:()=>h("download",l),onDoubleClick:a=>a.stopPropagation(),children:e.jsx(z,{title:t("common.button.download"),mouseEnterDelay:.3,children:e.jsx(C,{type:"icon-download",colorType:"action"})})})})})}}],[o,s,t,u,h])},xe=100*1024*1024,be=({onSuccess:n})=>{const{getIntlText:t}=T(),{s3UploadRequest:u}=ae({moduleName:"device"}),[o,m]=i.useState(),[s,d]=i.useState(null),h=_(({file:g})=>{const{status:r,url:l,response:a}=g;switch(m(g),r){case"error":{d(null),D.error(t("common.upload.fail"));break}case"uploading":{d(Math.floor(g.percent||0));break}case"removed":{d(null),m(void 0);break}case"done":case"success":{d(100),l&&n&&n(g,{keyName:(a==null?void 0:a.keyName)||"",url:l}),setTimeout(()=>{d(null)},500);break}}});return e.jsxs(v,{size:"md",className:"ms-resource-plugin-upload",children:[e.jsx(X,{accept:".jar",maxSize:xe,fileList:o?[o]:[],onChange:h,s3UploadRequest:u,children:e.jsx(U,{type:"ghost",disabled:(o==null?void 0:o.status)==="uploading",suffix:e.jsx(C,{type:"icon-upload"}),children:t("common.upload.upload")})}),s!==null&&e.jsxs("div",{className:"progress-bar-wrapper",children:[e.jsx("div",{className:"file-name",children:o==null?void 0:o.name}),e.jsx(ee,{percent:s})]})]})},fe=()=>{const{getIntlText:n}=T(),[t,u]=i.useState({total:0,current:1,pageSize:10}),{data:o,loading:m,run:s}=E(async()=>{const a=await j.getPlugins({pageSize:t.pageSize,pageNumber:t.current});return M(a)},{refreshDeps:[t.current,t.pageSize],onSuccess(a){u({...t,total:(a==null?void 0:a.total)||0})}}),d=_((a,p)=>{if(a==="download")return se({assets:p.url,fileName:p.fileName})}),h=he({onButtonClick:d}),g=_(async(a,p)=>{const[y,w]=await N(j.addPlugin({fileName:a.name,...p}));y||!K(w)||(s(),D.success(n("common.upload.success")))}),r=a=>{const{current:p,pageSize:y}=a;u({...t,current:p,pageSize:y})},l=(a,p)=>{if(a===1&&p===10&&a===t.current&&p===t.pageSize){s();return}u({...t,current:1,pageSize:10})};return e.jsx(e.Fragment,{children:e.jsx(F,{name:"table-resource-plugin",rowKey:"id",toolbarRender:e.jsx(be,{onSuccess:g}),loading:m,pagination:t,columns:h,dataSource:o==null?void 0:o.content,onChange:r,onRefresh:l})})},ye=()=>{const{getIntlText:n}=T();return i.useMemo(()=>[{key:"parser",title:n("mg.resource.tab_title_parser"),content:e.jsx(ge,{})},{key:"plugin",title:n("mg.resource.tab_title_plugin"),content:e.jsx(fe,{})},{key:"lang",title:n("mg.resource.tab_title_lang"),content:e.jsx(me,{})}],[n])},Se="parser",Pe=()=>{const[n,t]=te(),u=ye(),o=n.get(G)||Se,m=s=>{t({[G]:s})};return e.jsx("div",{className:"ms-main ms-main-full ms-main-resource",children:e.jsx(J,{className:"ms-product-profile-tabs",defaultActiveKey:o,onChange:m,children:u.map(s=>e.jsx(J.TabPane,{tab:s.title,children:s.content},s.key))})})};export{Pe as default};
