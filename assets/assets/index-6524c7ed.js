import{e as j,f as M,aq as K,n as p,Z as T,d as m,U as G,ar as Z,h as J,R as k,o as u,as as C,N as Q,u as X,at as Y,au as ee,av as te,aw as re,ax as se}from"./vendor-base-cc18fcff.js";import{c as oe,e as L,a as ne,w as q,i as F,u as z,b as ae,d as ce,o as ie,f as $,g as V,h,j as w,k as i,l as ue,m as b,n as le,p as P,q as v,r as de,E as me,s as f,t as pe,v as ge,I as fe,U as he,x as Ie,y as _e,z as B,A as Ee,R as Te,H as Se,L as Pe,T as ye,B as Ue,C as Ce,D as xe,F as Le,G as $e}from"./shared-4873712f.js";import{_ as I}from"./i18n-helper-ef5bc359.js";/* empty css                     */import"./vendor-c76f9059.js";import"./__commonjsHelpers__-23102255.js";import"./style-shared-6740825f.js";import"./style-pages-42a62cad.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function o(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(r){if(r.ep)return;r.ep=!0;const n=o(r);fetch(r.href,n)}})();const x=j(M(()=>({region:"US",dataCenter:"US",isCN:!1}))),y=j(K(M((e,t,o)=>{var s;return o.subscribe(r=>{r.isLogin=Object.keys((r==null?void 0:r.userInfo)||{}).length>0}),{isLogin:Object.keys(((s=t())==null?void 0:s.userInfo)||{}).length>0,userInfo:null,userId:null}}),{name:"admin",store:"user"})),we=()=>{const e=x(o=>o.dataCenter);return{formatName:p.useCallback(o=>oe(o,(e==null?void 0:e.toUpperCase())==="CN"),[e])}},be=[{errCodes:["forbidden_permission","account_session_logout","user_no_manage_access_permission","token_not_exist","token_invalid"],handler:e=>{const t=e&&L[e.toLocaleLowerCase()];if(t)T.destroy(),T.error(m.get(t));else{const o=m.get("common.message.error_server_error");T.error(o)}setTimeout(()=>{var r;ne();const o=G.stringify({referer:"management"}),s=`${((r=q)==null?void 0:r.account)||"/auth"}/login`;window.location.replace(`${s}?${o}`)},200)}},{errCodes:[...Object.keys(L)],handler(e,t){const o=e&&L[e.toLocaleLowerCase()];if(!o){console.warn("未添加全局接口错误码映射文案，请确认是否已自行处理",t);return}T.error(m.get(o))}}],R=(e,t)=>{var r;if(F(t)||(r=t==null?void 0:t.config)!=null&&r.$ignoreError)return;const o=m.get("common.message.error_server_error");if(!e||!t){console.warn("接口错误，且无任何响应，请通知后端处理"),T.error(o);return}const s=be.find(n=>n.errCodes.includes(e));if(!s){console.warn("未配置全局接口错误码处理逻辑，请确认是否已自行处理",t),T.error(o);return}s.handler(e,t)},ve=async e=>(e.headers=e.headers||{},e.headers["Accept-Language"]=V(),e.headers["X-REQUEST-CLIENT-TAG"]="manager_client",e);var N;const Oe=((N=z)==null?void 0:N.management)||"/",l=ae({baseURL:Oe,configHandlers:[ve,ce,ie],onConfigError(e){$(e.config)},onResponse(e){return R(e.data.errCode,e),$(e.config),e},onResponseError(e){var o;const t=e.response;return R((o=t==null?void 0:t.data)==null?void 0:o.errCode,t),$(e.config),e}}),U=e=>{var s,r;return(e||x.getState().dataCenter)==="CN"?((s=ue)==null?void 0:s.account)||"/":((r=z)==null?void 0:r.account)||"/"},O=h(l,{apis:{getUserIndex(e,t={}){return l.request({url:`${w}/users/index`,method:"GET",params:e,baseURL:U(),...t})},getUserInfo(e,t={}){const{userId:o,...s}=e||{};return l.request({url:`${w}/users/${o}`,method:"GET",params:s,baseURL:U(),...t})},logout(e,t={}){return l.request({url:`${w}/accounts/logout`,method:"POST",data:e,baseURL:U(),...t})},getUserList(e,t={}){const{region:o,...s}=e;return l.request({url:`${i}/users/search`,method:"POST",data:s,baseURL:U(o),...t})}}}),rt=h(l,{apis:{getProducts:`POST ${i}/products/search`,getProductDetail:`GET  ${i}/products/:productId`,addProduct:`POST ${i}/products`,deleteProduct:`DELETE ${i}/products/:productId`,updateProduct:`PUT ${i}/products`,publishProduct:`POST ${i}/products/publish`,addTSLorProfile:`POST ${i}/products/:productId/add`}}),st=h(l,{apis:{getThingSpecs:`GET ${i}/products/:productId/thing-specification/versions`,getThingSpecDetail:`GET ${i}/products/:productId/thing-specification?version=:version`,setDefaultThingSpec:`PUT ${i}/products/:productId/thing-specification/default-version`}}),ot=h(l,{apis:{getProfiles:`GET ${i}/products/:productId/profiles/versions`,getProfileDetail:`GET ${i}/products/:profileId/profiles`,getProfileForm:`GET ${i}/products/:profileId/form`,correctProfileJson:`POST ${i}/devices/profile-correction`}}),nt=h(l,{apis:{getS3UploadInfo(e,t={}){const{businessType:o,moduleName:s,...r}=e||{},n=s?`/${s}`:"";return l.request({url:`${n}${b}/component/storage/upload-url/${o}`,method:"POST",data:r,...t})},updateS3UploadInfo(e,t={}){const{moduleName:o,...s}=e||{},r=o?`/${o}`:"";return l.request({url:`${r}${b}/component/storage/update-url`,method:"GET",params:s,...t})}}}),at=h(l,{apis:{getParsers:`POST ${i}/devices/parsers/search`,getParserDetail:`GET ${i}/devices/parsers/:parserId`,addParser:`POST ${i}/devices/parsers`,deleteParser:`DELETE ${i}/devices/parsers/:parserId`,getPlugins:`POST ${i}/plugins/search`,addPlugin:`POST ${i}/plugins`,getLangs:`POST ${i}/multi-language/model-page`,getLangDetail:`POST ${i}/multi-language/search`,importLang:`POST ${i}/multi-language/import`,exportLang:`POST ${i}/multi-language/export`}}),ct=h(l,{apis:{getDeviceList:`POST ${i}/devices/search-manager`}});h(l,{apis:{exportExcel(e,t={}){const{schemaId:o,moduleName:s,...r}=e||{},n=s?`/${s}`:"";return l.request({url:`${n}${b}/component/excel/export/${o}`,method:"POST",data:r,responseType:"blob",...t})}}});const Re=h(l,{apis:{getDateTimeFormat:`GET ${i}/common/date-time-format`,getWebsocketInfo:`GET ${i}/iot-websocket/uri`}}),Ae=()=>{const{updateTimeFormats:e}=le();Z(async()=>{const[t,o]=await P(Re.getDateTimeFormat());if(t)return;const s=v(o);if(!s)return;e(s);const r=V();r&&J.updateLocale(r,{...de(s.weekStartWith)})})},S=new me,De=({loadUserId:e})=>{const[t,o]=p.useState(),[s,r]=p.useState("loading"),n=f(async d=>{const[g,_]=await P(O.getUserInfo({userId:d}));if(g)return;const E=v(_);if(E)return o(E),y.setState({userInfo:E}),E}),a=f(()=>s!=="loading"?Promise.resolve(t):new Promise((d,g)=>{S.subscribe("GET_USER_INFO_SUCCESS",_=>{const{status:E,data:W}=_||{};if(E==="success"){d(W);return}g()})})),c=f(async()=>{try{const d=await e();if(!d)throw Error();const g=await n(d);if(!g)throw Error();r("success"),S.publish("GET_USER_INFO_SUCCESS",{status:"success",data:g})}catch{r("fail"),S.publish("GET_USER_INFO_SUCCESS",{status:"error",data:null})}});return p.useEffect(()=>{c()},[]),{userInfo:t,getUserInfo:n,loadUserInfo:a}},Ne=({loadUserId:e})=>{const t=f(()=>{pe("management")});return{logout:f(async()=>{const s=await e();if(!s){t();return}const[r]=await P(O.logout({userId:s}));r||t()})}},je=({getUserInfo:e,loadUserId:t})=>{const{createRPCChannel:o}=Me(),s=f(async()=>{const a=await t();a&&await e(a)}),r=p.useMemo(()=>{if("BroadcastChannel"in window){const a=new BroadcastChannel("ACCOUNT");return a.onmessage=()=>{s()},a}},[]);return{goAccount:f(()=>{const a=o();a&&a.onmessage(async c=>{c.type==="UPDATE_INFO_SUCCESS"&&(r==null||r.postMessage(c),await s())})})}},Me=()=>{const e=p.useRef(),{hasLive:t,open:o,focus:s}=p.useRef(ge()).current,r=p.useMemo(()=>{var c;return((c=q)==null?void 0:c.account)||"/auth"},[]),n=f(()=>{if(t()){s();return}const{userInfo:c}=y.getState(),{dataCenter:d}=x.getState(),g=G.stringify({userId:c==null?void 0:c.userId,dataCenter:d,referer:"management"},{skipNulls:!0}),_=o(`${r}/account?${g}`,"_blank");if(_)return a(_)}),a=c=>{var g;(g=e.current)==null||g.destroy();const d=new fe({targetContext:c,origin:r},{name:"ACCOUNT"});return e.current=d,d};return{createRPCChannel:n}},Ge=({userIndexLoading:e})=>(p.useEffect(()=>{e||S.publish("GET_USER_ID_SUCCESS")},[e]),{loadUserId:()=>{const{userId:o}=y.getState();return e?new Promise(s=>{S.subscribe("GET_USER_ID_SUCCESS",()=>{const{userId:r}=y.getState();s(r)})}):Promise.resolve(o)}}),ke=k.memo(({userIndexLoading:e})=>{const{formatName:t}=we(),{loadUserId:o}=Ge({userIndexLoading:e}),{userInfo:s,getUserInfo:r}=De({loadUserId:o}),{logout:n}=Ne({loadUserId:o}),{goAccount:a}=je({getUserInfo:r,loadUserId:o}),c=p.useMemo(()=>({name:t(s),email:(s==null?void 0:s.email)||"",avatar:s==null?void 0:s.avatar}),[s,t]);return u.jsx(he,{userInfo:c,onMenuClick:async d=>{if(d.key==="logout"){await n();return}d.key==="account"&&a()}})}),H=[{path:"/product",handle:{get title(){return m.get("common.label.product")}},element:u.jsx(C,{}),children:[{index:!0,handle:{get title(){return m.get("common.label.product")}},async lazy(){const{default:e}=await I(()=>import("./index-01866591.js"),["assets/index-01866591.js","assets/vendor-base-cc18fcff.js","assets/vendor-c76f9059.js","assets/__commonjsHelpers__-23102255.js","assets/i18n-helper-ef5bc359.js","assets/useColumns-31cfb7a0.js","assets/shared-4873712f.js","assets/style-shared-6740825f.js","assets/style-shared-952257b5.css","assets/style-pages-42a62cad.js","assets/style-pages-e03ce8b0.css","assets/style-common-3f6ae1da.css"]);return{Component:e}}},{path:"detail/:productId",handle:{get title(){return m.get("common.label.detail")}},async lazy(){const{default:e}=await I(()=>import("./index-2be17af7.js"),["assets/index-2be17af7.js","assets/vendor-base-cc18fcff.js","assets/vendor-c76f9059.js","assets/__commonjsHelpers__-23102255.js","assets/i18n-helper-ef5bc359.js","assets/shared-4873712f.js","assets/style-shared-6740825f.js","assets/style-shared-952257b5.css","assets/style-pages-42a62cad.js","assets/style-pages-e03ce8b0.css","assets/useColumns-31cfb7a0.js","assets/usePhotoUpload-fd7bbc46.js","assets/useS3Upload-00eba9e8.js","assets/index-cbf4ccd1.js","assets/style-common-3f6ae1da.css"]);return{Component:e}}},{path:"add",handle:{get title(){return m.get("common.label.title_add_product")}},async lazy(){const{default:e}=await I(()=>import("./index-c454e067.js"),["assets/index-c454e067.js","assets/vendor-base-cc18fcff.js","assets/vendor-c76f9059.js","assets/__commonjsHelpers__-23102255.js","assets/i18n-helper-ef5bc359.js","assets/index-cbf4ccd1.js","assets/shared-4873712f.js","assets/style-shared-6740825f.js","assets/style-shared-952257b5.css","assets/style-pages-42a62cad.js","assets/style-pages-e03ce8b0.css","assets/useColumns-31cfb7a0.js","assets/usePhotoUpload-fd7bbc46.js","assets/useS3Upload-00eba9e8.js","assets/style-common-3f6ae1da.css"]);return{Component:e}}}]},{path:"/device",handle:{get title(){return m.get("common.label.device")}},element:u.jsx(C,{}),children:[{index:!0,handle:{get title(){return m.get("common.label.device")}},async lazy(){const{default:e}=await I(()=>import("./index-7832d86c.js"),["assets/index-7832d86c.js","assets/vendor-base-cc18fcff.js","assets/vendor-c76f9059.js","assets/__commonjsHelpers__-23102255.js","assets/i18n-helper-ef5bc359.js","assets/shared-4873712f.js","assets/style-shared-6740825f.js","assets/style-shared-952257b5.css","assets/style-pages-42a62cad.js","assets/style-pages-e03ce8b0.css","assets/style-common-3f6ae1da.css"]);return{Component:e}}},{path:"profile-tsl/synthesize/tool",handle:{get title(){return m.get("common.label.device")}},async lazy(){const{default:e}=await I(()=>import("./index-3459a905.js"),["assets/index-3459a905.js","assets/vendor-base-cc18fcff.js","assets/vendor-c76f9059.js","assets/__commonjsHelpers__-23102255.js","assets/i18n-helper-ef5bc359.js","assets/shared-4873712f.js","assets/style-shared-6740825f.js","assets/style-shared-952257b5.css","assets/style-pages-42a62cad.js","assets/style-pages-e03ce8b0.css","assets/useS3Upload-00eba9e8.js","assets/style-common-3f6ae1da.css"]);return{Component:e}}}]},{path:"/user",handle:{get title(){return m.get("menu.user")}},async lazy(){const{default:e}=await I(()=>import("./index-a9128579.js"),["assets/index-a9128579.js","assets/vendor-base-cc18fcff.js","assets/vendor-c76f9059.js","assets/__commonjsHelpers__-23102255.js","assets/i18n-helper-ef5bc359.js","assets/shared-4873712f.js","assets/style-shared-6740825f.js","assets/style-shared-952257b5.css","assets/style-pages-42a62cad.js","assets/style-pages-e03ce8b0.css","assets/style-common-3f6ae1da.css"]);return{Component:e}}},{path:"/resource",handle:{get title(){return m.get("menu.resource")}},async lazy(){const{default:e}=await I(()=>import("./index-21496a37.js"),["assets/index-21496a37.js","assets/vendor-base-cc18fcff.js","assets/vendor-c76f9059.js","assets/__commonjsHelpers__-23102255.js","assets/i18n-helper-ef5bc359.js","assets/shared-4873712f.js","assets/style-shared-6740825f.js","assets/style-shared-952257b5.css","assets/style-pages-42a62cad.js","assets/style-pages-e03ce8b0.css","assets/index-cbf4ccd1.js","assets/useS3Upload-00eba9e8.js","assets/style-common-3f6ae1da.css"]);return{Component:e}}},{path:"*",handle:{title:"404",layout:"blank",authFree:!0},async lazy(){const{default:e}=await I(()=>import("./index-e9046182.js"),["assets/index-e9046182.js","assets/vendor-base-cc18fcff.js","assets/vendor-c76f9059.js","assets/__commonjsHelpers__-23102255.js","assets/i18n-helper-ef5bc359.js","assets/shared-4873712f.js","assets/style-shared-6740825f.js","assets/style-shared-952257b5.css","assets/style-pages-42a62cad.js","assets/style-pages-e03ce8b0.css"]);return{Component:e}}}],qe=()=>{const[e,t]=p.useState(!0),o=f(async()=>{const[n,a]=await P(O.getUserIndex());if(!(n||!F(a)))return v(a)}),s=f(async()=>{const n=await o();if(!n)return;const{userId:a,dataCenter:c}=n||{};a&&(y.setState({userId:a}),Ie.setItem(_e("",a),{userId:a})),c&&x.setState({dataCenter:c==null?void 0:c.toUpperCase()})});return{initializeUser:f(async()=>{await P(s()),t(!1)}),userIndexLoading:e}},A="Asia/Shanghai";function Fe(){const{lang:e}=B(),{timezone:t,setTimezone:o}=Ee(),{initializeUser:s,userIndexLoading:r}=qe(),n=p.useMemo(()=>H.filter(a=>{var c;return a.path&&((c=a.handle)==null?void 0:c.layout)!=="blank"}).map(a=>{var c;return{name:((c=a.handle)==null?void 0:c.title)||"",path:a.path||""}}),[e]);return(t==null?void 0:t.id)!==A&&o(A),p.useEffect(()=>{s()},[]),u.jsxs("section",{className:"ms-layout",children:[u.jsx(Te,{}),u.jsx(Se,{menus:n,children:u.jsxs(Q,{size:"xl",children:[u.jsx("div",{className:"ms-tz-label",children:t==null?void 0:t.utcStr}),u.jsx(Pe,{platform:"management"}),u.jsx(ye,{}),u.jsx(ke,{userIndexLoading:r})]})}),u.jsx("main",{className:"ms-layout-body",children:u.jsx(C,{})})]})}const ze=()=>u.jsx("div",{className:"ms-layout",children:u.jsx(C,{})}),Ve="basic",D={basic:u.jsx(Fe,{}),blank:u.jsx(ze,{})};function Be(){const{antdLocale:e,getIntlText:t}=B(),{antdTheme:o}=Ue();Ae();const r=X().at(-1);let{layout:n=""}=(r==null?void 0:r.handle)||{};(!n||!D[n])&&(n=Ve);const a=c=>{switch(c){default:return u.jsx(Ce,{size:"small",text:t("common.placeholder.empty")})}};return u.jsx(Y,{theme:o,locale:e,renderEmpty:a,children:D[n]})}const He=[{path:"/",element:u.jsx(Be,{}),children:[{path:"/",element:u.jsx(ee,{to:"/product"})},...H]}],We=te(He,{basename:$e});xe("management","CN");Le();re.render(u.jsx(k.StrictMode,{children:u.jsx(se,{router:We})}),document.getElementById("root"));export{ot as a,nt as b,ct as d,st as m,rt as p,at as r,O as u};
